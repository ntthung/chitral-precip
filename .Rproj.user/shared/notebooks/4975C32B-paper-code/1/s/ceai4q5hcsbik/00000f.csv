"0","recFinal[, rolMax := frollapply(Qbc, 50, max, align = 'right')]"
"0","recFinal[, rolMin := frollapply(Qbc, 50, min, align = 'right')]"
"0","recFinal[, rolMed := frollapply(Qbc, 50, median, align = 'right')]"
"0","recFinal[, period := fcase("
"0","  year %in% 1517:1767, 1,"
"0","  default = 2)]"
"0","densCals <- recFinal[, {"
"0","  d <- density(Qbc, cut = 0, bw = 45)"
"0","  list(x = d$x, y = d$y / max(d$y) * 1.5)"
"0","}, by = period]"
"0",""
"0","medians <- recFinal[, {"
"0","  d <- density(Qbc, cut = 0, bw = 45)"
"0","  m <- median(Qbc)"
"0","  y <- approx(d$x, d$y, m)$y"
"0","  list(x = m, y = y / max(d$y) * 1.5)"
"0","}, by = period]"
"0",""
"0","recFinal[, dP := Qbc - mean(Qbc),"
"0","       ][, type := classify_events(dP)"
"0","       ][, dp10 := pass.filt(dP, 10)]"
"0","droughts <- get_timing(recFinal$dP, recFinal$type)[type == 'drought']"
"0","droughts[, ':='(yearStart = recFinal[start, year],"
"0","                period = recFinal[start, period],"
"0","                yearFinal = recFinal[final, year])]"
"0","worstDroughts <- droughts[order(peak)][1:3]"
